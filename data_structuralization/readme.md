# 数据结构化(structuralization)
## 原始数据的输出格式
- 整体为一个pd.DataFrame，其结构为：

    |id|total|characters|persons|comments|
    |-|-|-|-|-|
    |string|list|list|list|list|

如上表格所示，对于每一款产品，都是该DataFrame中的一行。各产品信息都有5个属性：

- id：以字符串的形式存放该产品在bangumi中的编号
- total：以列表的形式存放该产品的概览页面的信息，该列表中有3个元素，每个元素都是字符串，分别存放了：
    - 左侧简要信息
    - 中部所有tag标签
    - 右部的评分、rank
- characters：以列表的形式存放该产品的角色页面信息，该列表的每个元素为字符串，每个字符串存放：
    - cv姓名
    - 是主角还是配角
- persons：以列表的形式存放该产品的制作人员页面信息，该列表的每个元素为字符串，每个字符串存放：
    - 每位成员名称
    - 担任职务
- comments：以列表的形式存放该产品的吐槽页面信息，该列表的每个元素为字符串，每个字符串存放：
    - 每条评论的用户id
    - 每条评论的评论时间
    - 每条评论的内容
    - 每条评论给出的产品评分
## 结构化方式
### 属性id
- 不做处理
### 属性total
1. 作原始数据的切片，记为raw_data_total：

    |id|total|
    |-|-|
    |string|list|
    
2. 根据total的结构，将raw_data_total细化，记为total：

    |id|left|mid|right|
    |-|-|-|-|
    |string|string|string|string|
    
    其中，属性left、mid、right分别表示左侧简要信息、中部tag标签、右侧评分与rank
3. 对total取三份切片，分别记为total_left、total_mid、total_right：

    |id|left|
    |-|-|
    |string|string|

    |id|mid|
    |-|-|
    |string|string|

    |id|right|
    |-|-|
    |string|string|
    
    接下来对这三份切片分别作处理。
4. - 对total_left，记其处理后输出的数据集名为total_brief：
        1. 根据爬取数据时事先规定好的分割符，对属性left的内容进行分割。分割所得的每一单元对应该产品的一条基本信息。
        2. 根据每一类基本信息类别及其内容，于数据集total_brief中填入信息。
        - e.g.
            以如下信息为例演示处理方式：
            
            |id|left|
            |-|-|
            |XXXX|'名称:WHITE ALBUM2 -closing chapter-\|-\*-\|中文名: 白色相簿2 终章\|-\*-\|平台: PC\|-\*-\|游戏类型: AVG\|-\*-\|发行日期: 2011/12/22\|-\*-\|'|

            1. 根据分割符'\|-\*-\|'分割属性left的内容，得到如下分割：
            ['名称:WHITE ALBUM2 -closing chapter-','中文名: 白色相簿2 终章','平台: PC','游戏类型: AVG','发行日期: 2011/12/22']
            2. 根据分割内容创建total_brief：

                |id|基本信息类别|内容|
                |-|-|-|
                |XXXX|名称|WHITE ALBUM2 -closing chapter-|
                |XXXX|中文名|白色相簿2 终章|
                |XXXX|平台|PC|
                |XXXX|游戏类型|AVG|
                |XXXX|发行日期|2011/12/22|
                
    - 对total_mid，记其处理后输出的数据集名为total_tag：
        1. 根据爬取数据时事先规定好的分割符，对属性mid的内容进行分割。分割所得每一单元对应该产品的一个tag。
        2. 根据每一个tag的名称及标记人数，于数据集total_tag中填入信息。
        - e.g.
            以如下信息为例演示处理方式：

            |id|mid|
            |-|-|
            |XXXX| '丸戸史明 653\|-\*-\|leaf 573\|-\*-\|galgame 514\|-\*-\|WA2 281\|-\*-\|脱宅神作 223\|-\*-\|'|
            
            1. 根据分割符'\|-\*-\|'分割属性mid的内容，得到如下分割：
             ['丸戸史明 653','leaf 573','galgame 514','WA2 281','脱宅神作 223']
            2. 根据分割内容创建total_tag:

                |id|标签名称|标记人数|
                |-|-|-|
                |XXXX|丸戸史明|653|
                |XXXX|leaf|573|
                |XXXX|galgame|514|
                |XXXX|WA2|281|
                |XXXX|脱宅神作|223|

    - 对total_right，记其处理后输出的数据集名称为total_rank：
        1. 根据爬取数据时事先规定好的分割符，对属性right的内容进行分割。
        2. 根据分割内容，于数据集total_rank中填入信息。
        - e.g.
            以如下信息演示处理方式：

            |id|right|
            |-|-|
            |XXXX|'8.9\|-\*-\|#13'|

            1. 根据分割符'\|-\*-\|'分割属性right的内容，得到如下分割：
            [8.9,13]
            2. 根据分割内容创建total_rank：

                |id|评分|排名|
                |-|-|-|
                |XXXX|8.9|13|

### 属性characters
1. 建立新的数据集，记为characters_voice。
2. 遍历原始属性characters中的每个元素，根据特定的分词符号将每个元素的内容分开，而后填入characters_vocie。
- e.g.
    以如下信息演示处理方式：

    |id|characters|
    |-|-|
    |XXXX|['主角\|-\*-\|水島大宙', '主角\|-\*-\|米澤円', '主角\|-\*-\|生天目仁美']|

    遍历属性characters的每一个元素，根据分割符'\|-\*-\|'分割元素，将相应信息填入characters_voice:

    |id|声优|角色类型|
    |-|-|-|
    |XXXX|水島大宙|主角|
    |XXXX|米澤円|主角|
    |XXXX|生天目仁美|主角|

### 属性persons
1. 建立新的数据集persons_division。
2. 遍历属性persons中的每个元素，根据特定的分词符号将每个元素的内容分开，而后填入persons_divison。
- e.g. 
    以如下信息演示处理方式：

    |id|persons|
    |-|-|
    |XXXX|['アクアプラス :开发\|-\*-\|', 'Leaf  / Leaf:开发\|-\*-\|', '丸戸史明  / 丸户史明:剧本\|-\*-\|企画\|-\*-\|']|

    遍历属性persons中的每一个元素，根据分割符'\\'、':'、'\|-\*-\|'分割元素，将相应信息填入persons_division：

    |id|原名|中文名|职务1|职务2|职务3|职务4|职务5|
    |-|-|-|-|-|-|-|-|
    |XXXX|アクアプラス||开发|||||
    |XXXX|Leaf|Leaf|开发|||||
    |XXXX|丸戸史明|丸户史明|剧本|企画||||

### 属性comments
1. 建立新的数据集comments_tsukkomi。
2. 遍历属性comments中每个元素，根据特定的分词符号将每个元素的内容分开，而后填入comments_tsukkomi。
- e.g. 
    以如下信息演示处理方式：

    |id|comments|
    |-|-|
    |XXXX|['梦L\|-\*-\|@ 2019-7-6 12:53\|-\*-\|个人认为的神作之一，当初留下印象最深的一部黄油。\|-\*-\|sstars10', '狒系青年\|-\*-\|@ 2019-7-5 21:43\|-\*-\|传递不到的爱恋\|-\*-\|sstars9', 'ef\|-\*-\|@ 2019-7-3 12:06\|-\*-\|どうしてこうなるだろう...?\|-\*-\|sstars99']|

    遍历属性comments中的每个元素，根据分割符'\|-\*-\|'分割元素，将响应的信息填入comments_tsukkomi：

    |id|评论内容|评分|评论用户名|评论日期|
    |-|-|-|-|-|
    |XXXX|个人认为的神作之一，当初留下印象最深的一部黄油。|10|梦L|2019-7-6 12:53|
    |XXXX|传递不到的爱恋|9|狒系青年|2019-7-5 21:43|
    |XXXX|どうしてこうなるだろう...?|99|ef|2019-7-3 12:06|

    注："个人评分"中"99"是未评分的标记，后期会处理。

